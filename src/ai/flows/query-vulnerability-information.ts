'use server';

/**
 * @fileOverview A flow that allows querying the LLM about specific vulnerabilities or patch information.
 *
 * - queryVulnerabilityInformation - A function that handles the vulnerability information querying process.
 * - QueryVulnerabilityInformationInput - The input type for the queryVulnerabilityInformation function.
 * - QueryVulnerabilityInformationOutput - The return type for the queryVulnerabilityInformation function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const QueryVulnerabilityInformationInputSchema = z.object({
  query: z.string().describe('The query about vulnerabilities or patch information.'),
});
export type QueryVulnerabilityInformationInput = z.infer<typeof QueryVulnerabilityInformationInputSchema>;

const QueryVulnerabilityInformationOutputSchema = z.object({
  response: z.string().describe('The LLM response to the vulnerability information query.'),
});
export type QueryVulnerabilityInformationOutput = z.infer<typeof QueryVulnerabilityInformationOutputSchema>;

export async function queryVulnerabilityInformation(input: QueryVulnerabilityInformationInput): Promise<QueryVulnerabilityInformationOutput> {
  return queryVulnerabilityInformationFlow(input);
}

const prompt = ai.definePrompt({
  name: 'queryVulnerabilityInformationPrompt',
  input: {schema: QueryVulnerabilityInformationInputSchema},
  output: {schema: QueryVulnerabilityInformationOutputSchema},
  prompt: `You are a security expert AI assistant named PatchWise. Your role is to provide clear, concise, and accurate information about cybersecurity vulnerabilities, patches, and related topics.

  A user has the following question:
  "{{{query}}}"

  Please provide a detailed and informative answer. Your response should be structured and easy to read.
  Use Markdown for formatting, including but not limited to:
  - **Bold** and *italics* for emphasis.
  - Bullet points (-) for lists.
  - Numbered lists for sequential steps.
  - Tables for structured data.
  - Code blocks (\`\`\`) for commands or code snippets.

  Always strive to be helpful and provide actionable advice when possible.
  `,
});

const queryVulnerabilityInformationFlow = ai.defineFlow(
  {
    name: 'queryVulnerabilityInformationFlow',
    inputSchema: QueryVulnerabilityInformationInputSchema,
    outputSchema: QueryVulnerabilityInformationOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);
